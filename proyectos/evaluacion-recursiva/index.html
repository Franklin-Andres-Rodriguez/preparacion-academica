<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Laboratory - El Misterio del Sistema de Calificaciones | Bugs que Cuestan Millones</title>
    <meta name="description" content="Descubre el bug que afect√≥ a 847 estudiantes universitarios - Un error de precedencia que cambi√≥ vidas">
    <style>
        /* =================================================
         * EVALUACION RECURSIVA - INTERMEDIATE-LEVEL SYSTEM
         * Following Kent C. Dodds' testing-focused development
         * and Ian Sommerville's systematic debugging approach
         * ================================================= */
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 35px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Intermediate-level Achievement Indicator */
        .achievement-indicator {
            position: absolute;
            top: 15px;
            right: 20px;
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            color: white;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
            opacity: 0.9;
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(56, 161, 105, 0.3);
        }
        
        .achievement-indicator.active {
            opacity: 1;
            transform: scale(1.05) rotate(-1deg);
            box-shadow: 0 6px 25px rgba(56, 161, 105, 0.5);
        }
        
        .achievement-indicator.debugging {
            background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);
            box-shadow: 0 6px 25px rgba(159, 122, 234, 0.5);
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #e74c3c;
            padding-bottom: 15px;
            margin-bottom: 25px;
            font-size: 2.1em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .case-study {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin: 25px 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(238, 90, 36, 0.3);
        }
        
        .case-study::before {
            content: 'üìö';
            position: absolute;
            top: -15px;
            right: 25px;
            font-size: 3em;
            opacity: 0.3;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .bug-demonstration {
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
            border: 3px solid #fc8181;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            position: relative;
            box-shadow: 0 8px 20px rgba(252, 129, 129, 0.2);
        }
        
        .bug-demonstration::before {
            content: 'üß™';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2em;
            background: #fff5f5;
            padding: 0 10px;
        }
        
        .main-workspace {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        .student-solution {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            padding: 25px;
            border-radius: 12px;
            border-left: 5px solid #e53e3e;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .student-solution:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .debug-panel {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: #f7fafc;
            padding: 25px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            box-shadow: 0 8px 20px rgba(26, 32, 44, 0.4);
            position: relative;
        }
        
        .debug-panel::before {
            content: 'üîç';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2em;
            background: #1a202c;
            padding: 0 10px;
        }
        
        /* Enhanced Progress System for Debugging */
        .debug-progress-system {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            min-width: 280px;
            z-index: 1000;
            transition: all 0.4s ease;
            opacity: 0;
            transform: translateX(-30px);
        }
        
        .debug-progress-system.active {
            opacity: 1;
            transform: translateX(0);
        }
        
        .progress-section {
            margin: 15px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #38a169, #9f7aea);
            width: 0%;
            transition: width 1s ease;
            position: relative;
        }
        
        .progress-fill.debugging {
            background: linear-gradient(90deg, #9f7aea, #667eea);
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 20px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6));
            animation: progress-shine 2s infinite;
        }
        
        @keyframes progress-shine {
            0% { transform: translateX(-20px); }
            100% { transform: translateX(20px); }
        }
        
        .debugging-mastery {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 12px;
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            border-radius: 8px;
            opacity: 0;
            transition: all 0.5s ease;
        }
        
        .debugging-mastery.active {
            opacity: 1;
        }
        
        .grade-input, .weight-input {
            padding: 10px;
            margin: 8px;
            border: 2px solid #cbd5e0;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .grade-input {
            width: 80px;
        }
        
        .weight-input {
            width: 60px;
        }
        
        .grade-input:focus, .weight-input:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
            transform: scale(1.05);
        }
        
        .code-display {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            border-left: 4px solid #e53e3e;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .evaluation-tree {
            background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
            border: 2px solid #68d391;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            font-family: 'Courier New', monospace;
            position: relative;
            box-shadow: 0 4px 15px rgba(104, 211, 145, 0.2);
        }
        
        .evaluation-tree::before {
            content: 'üå≥';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2em;
            background: #f0fff4;
            padding: 0 10px;
        }
        
        .tree-node {
            padding: 10px 15px;
            margin: 6px;
            border-radius: 25px;
            display: inline-block;
            min-width: 50px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .tree-node:hover {
            transform: scale(1.15) rotate(2deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
            z-index: 10;
        }
        
        .tree-operator {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            color: white;
        }
        
        .tree-number {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
        }
        
        .tree-result {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            color: white;
            animation: pulse-green 2s infinite;
        }
        
        .tree-active {
            background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
            color: white;
            animation: pulse-orange 0.8s infinite;
            transform: scale(1.2);
            z-index: 15;
        }
        
        @keyframes pulse-green {
            0%, 100% { opacity: 1; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
            50% { opacity: 0.8; box-shadow: 0 4px 20px rgba(56, 161, 105, 0.4); }
        }
        
        @keyframes pulse-orange {
            0%, 100% { opacity: 1; box-shadow: 0 4px 15px rgba(237, 137, 54, 0.5); }
            50% { opacity: 0.7; box-shadow: 0 8px 30px rgba(237, 137, 54, 0.8); }
        }
        
        @keyframes pulse-red {
            0%, 100% { opacity: 1; box-shadow: 0 4px 15px rgba(229, 62, 62, 0.5); }
            50% { opacity: 0.7; box-shadow: 0 8px 30px rgba(229, 62, 62, 0.8); }
        }
        
        .step-explanation {
            background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
            border-left: 4px solid #38b2ac;
            padding: 20px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(56, 178, 172, 0.1);
        }
        
        .step-explanation.active {
            background: linear-gradient(135deg, #fef5e7 0%, #fed7aa 100%);
            border-left-color: #f6ad55;
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(246, 173, 85, 0.2);
        }
        
        .problem-highlight {
            background: linear-gradient(135deg, #fed7d7 0%, #fbb6ce 100%);
            border: 2px solid #fc8181;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(252, 129, 129, 0.2);
        }
        
        .solution-highlight {
            background: linear-gradient(135deg, #c6f6d5 0%, #9ae6b4 100%);
            border: 2px solid #68d391;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(104, 211, 145, 0.2);
            position: relative;
        }
        
        .solution-highlight::before {
            content: 'üí°';
            position: absolute;
            top: -15px;
            left: 20px;
            font-size: 2em;
            background: #c6f6d5;
            padding: 0 10px;
        }
        
        button {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 8px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(66, 153, 225, 0.3);
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(66, 153, 225, 0.4);
        }
        
        .debug-btn {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.3);
        }
        
        .debug-btn:hover {
            box-shadow: 0 8px 25px rgba(229, 62, 62, 0.4);
        }
        
        .solve-btn {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            box-shadow: 0 4px 15px rgba(56, 161, 105, 0.3);
        }
        
        .solve-btn:hover {
            box-shadow: 0 8px 25px rgba(56, 161, 105, 0.4);
        }
        
        .test-case {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid #cbd5e0;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .test-case:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .test-case.failed {
            background: rgba(254, 215, 215, 0.9);
            border-color: #fc8181;
            animation: warning-glow 3s infinite;
        }
        
        .test-case.passed {
            background: rgba(198, 246, 213, 0.9);
            border-color: #68d391;
            animation: success-glow 2s ease-out;
        }
        
        @keyframes warning-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(252, 129, 129, 0.3); }
            50% { box-shadow: 0 0 20px rgba(252, 129, 129, 0.6); }
        }
        
        @keyframes success-glow {
            0% { box-shadow: 0 0 0 rgba(104, 211, 145, 0.7); }
            100% { box-shadow: 0 0 20px rgba(104, 211, 145, 0.4); }
        }
        
        .tooltip {
            position: absolute;
            background: rgba(45, 55, 72, 0.95);
            color: white;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 12px;
            top: -45px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: rgba(45, 55, 72, 0.95);
        }
        
        .tree-node:hover .tooltip {
            opacity: 1;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-workspace {
                grid-template-columns: 1fr;
            }
            
            .debug-progress-system {
                position: static;
                margin: 20px 0;
                transform: none;
                opacity: 1;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 25px;
                margin: 15px;
            }
            
            .case-study {
                padding: 20px;
            }
            
            .tree-node {
                padding: 8px 12px;
                margin: 4px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Intermediate Achievement Indicator -->
        <div id="achievementIndicator" class="achievement-indicator debugging">
            üéØ Caso Intermedio: Debug Laboratory
        </div>
        
        <!-- Debug Progress System -->
        <div id="debugProgressSystem" class="debug-progress-system">
            <div style="font-weight: 700; color: #2d3748; font-size: 16px; margin-bottom: 15px;">Progreso de Debugging</div>
            
            <div class="progress-section">
                <div style="font-size: 13px; color: #718096;">Exploraci√≥n de Casos</div>
                <div class="progress-bar">
                    <div id="explorationProgress" class="progress-fill"></div>
                </div>
            </div>
            
            <div class="progress-section">
                <div style="font-size: 13px; color: #718096;">An√°lisis Interactivo</div>
                <div class="progress-bar">
                    <div id="debuggingProgress" class="progress-fill debugging"></div>
                </div>
            </div>
            
            <div class="progress-section">
                <div style="font-size: 13px; color: #718096;">Comprensi√≥n del Bug</div>
                <div class="progress-bar">
                    <div id="comprehensionProgress" class="progress-fill"></div>
                </div>
            </div>
            
            <div id="debuggingMastery" class="debugging-mastery">
                <span style="font-size: 20px;">üèÜ</span>
                <span style="font-size: 14px; font-weight: 600; color: #2f855a;">¬°Bug Detectado y Solucionado!</span>
            </div>
        </div>
        
        <h1>üîç Debug Laboratory - El Misterio del Sistema de Calificaciones</h1>
        
        <div class="case-study">
            <h3>üìö Historia Real - Universidad Nacional 2019</h3>
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; align-items: center;">
                <div>
                    <p><strong>El Problema:</strong> Un equipo de estudiantes de ingenier√≠a desarroll√≥ un sistema para calcular promedios ponderados de calificaciones. Funcionaba "perfectamente" en casos simples, pero produc√≠a resultados incorrectos en situaciones complejas.</p>
                    <p><strong>Su f√≥rmula "obvia":</strong></p>
                    <code style="background: rgba(26, 32, 44, 0.8); color: #fed7d7; padding: 8px 12px; border-radius: 6px; font-size: 14px;">
                        promedio = nota1 * peso1 + nota2 * peso2 + nota3 * peso3 / peso1 + peso2 + peso3
                    </code>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2.5em; color: rgba(255, 255, 255, 0.9);">847</div>
                    <div style="font-size: 12px; font-weight: 600;">ESTUDIANTES AFECTADOS</div>
                </div>
            </div>
            
            <div style="background: rgba(26, 32, 44, 0.2); padding: 20px; border-radius: 8px; margin-top: 20px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                    <div><strong>‚è∞ Tiempo perdido:</strong><br>3 semanas de notas incorrectas</div>
                    <div><strong>üìä Casos afectados:</strong><br>2,341 c√°lculos err√≥neos</div>
                    <div><strong>üéì Impacto acad√©mico:</strong><br>15 estudiantes reprobaron injustamente</div>
                    <div><strong>üí° Tiempo de debug:</strong><br>18 horas hasta encontrar el bug</div>
                </div>
            </div>
            
            <p><strong>üö® Tu Misi√≥n:</strong> Usar el laboratorio de debug interactivo para descubrir exactamente qu√© caus√≥ este bug devastador. ¬øPueden encontrarlo m√°s r√°pido que el equipo original?</p>
        </div>

        <div class="bug-demonstration">
            <h4>üß™ Reproduzcan el Bug - Sistema "Funcional"</h4>
            <p><strong>Instrucciones:</strong> Prueben estos casos reales y observen cuidadosamente. ¬øNotan algo extra√±o en los resultados?</p>
            
            <div class="test-case" id="testCase1">
                <strong>üìñ Caso 1 - Estudiante Promedio (Mar√≠a Gonz√°lez):</strong><br>
                Matem√°ticas: 85 (peso 30%), F√≠sica: 90 (peso 30%), Qu√≠mica: 80 (peso 40%)
                <div style="margin: 15px 0; display: flex; flex-wrap: wrap; align-items: center; gap: 10px;">
                    <div>Nota 1: <input type="number" id="grade1_1" class="grade-input" value="85"></div>
                    <div>Peso: <input type="number" id="weight1_1" class="weight-input" value="30">%</div>
                    <div>Nota 2: <input type="number" id="grade2_1" class="grade-input" value="90"></div>
                    <div>Peso: <input type="number" id="weight2_1" class="weight-input" value="30">%</div>
                    <div>Nota 3: <input type="number" id="grade3_1" class="grade-input" value="80"></div>
                    <div>Peso: <input type="number" id="weight3_1" class="weight-input" value="40">%</div>
                </div>
                <button onclick="calculateCase(1)">üßÆ Calcular con F√≥rmula de Estudiantes</button>
                <button onclick="calculateCorrect(1)" class="solve-btn">‚úÖ Calcular Correctamente</button>
                <div id="result1"></div>
            </div>

            <div class="test-case" id="testCase2">
                <strong>üìö Caso 2 - Estudiante Problema (Carlos Mendoza):</strong><br>
                Historia: 95 (peso 25%), Literatura: 88 (peso 35%), Arte: 92 (peso 40%)
                <div style="margin: 15px 0; display: flex; flex-wrap: wrap; align-items: center; gap: 10px;">
                    <div>Nota 1: <input type="number" id="grade1_2" class="grade-input" value="95"></div>
                    <div>Peso: <input type="number" id="weight1_2" class="weight-input" value="25">%</div>
                    <div>Nota 2: <input type="number" id="grade2_2" class="grade-input" value="88"></div>
                    <div>Peso: <input type="number" id="weight2_2" class="weight-input" value="35">%</div>
                    <div>Nota 3: <input type="number" id="grade3_2" class="grade-input" value="92"></div>
                    <div>Peso: <input type="number" id="weight3_2" class="weight-input" value="40">%</div>
                </div>
                <button onclick="calculateCase(2)">üßÆ Calcular con F√≥rmula de Estudiantes</button>
                <button onclick="calculateCorrect(2)" class="solve-btn">‚úÖ Calcular Correctamente</button>
                <div id="result2"></div>
            </div>
        </div>

        <div class="main-workspace">
            <div class="student-solution">
                <h4>üíª C√≥digo del Estudiante (Aparentemente Correcto)</h4>
                <div class="code-display" id="studentCode">
// F√≥rmula "obvia" para promedio ponderado
// Los estudiantes pensaron que era una implementaci√≥n directa
promedio = nota1 * peso1 + nota2 * peso2 + nota3 * peso3 / peso1 + peso2 + peso3;

// "Multiplico cada nota por su peso, sumo todo, 
//  y divido por la suma de pesos. ¬°Obvio!"
                </div>
                
                <div class="step-explanation">
                    <strong>üéì L√≥gica del Equipo de Estudiantes:</strong><br>
                    <em>"Nuestra f√≥rmula es matem√°ticamente correcta. Multiplicamos cada nota por su peso, sumamos todos los productos, y dividimos por la suma de los pesos. Es exactamente como se calcula un promedio ponderado en matem√°ticas."</em><br><br>
                    <strong>ü§î Su Confianza:</strong> El c√≥digo "funcionaba" en casos simples, as√≠ que asumieron que estaba correcto.
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="debug-btn" onclick="startDebugging()">üîß Iniciar Debug Interactivo</button>
                    <button onclick="showManualCalculation()">üßÆ C√°lculo Manual Paso a Paso</button>
                </div>
            </div>
            
            <div class="debug-panel">
                <h4>üå≥ Laboratorio de Evaluaci√≥n JavaScript</h4>
                <div id="debugOutput">
                    <div style="text-align: center; color: #a0aec0; padding: 40px 20px;">
                        <div style="font-size: 3em; margin-bottom: 15px;">üî¨</div>
                        <div style="font-size: 16px; margin-bottom: 10px;">Debug Laboratory Waiting...</div>
                        <div style="font-size: 14px;">Haz clic en "Iniciar Debug Interactivo" para</div>
                        <div style="font-size: 14px;">ver exactamente c√≥mo JavaScript</div>
                        <div style="font-size: 14px;">eval√∫a la expresi√≥n problem√°tica</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="evaluationSteps"></div>

        <div class="solution-highlight" id="solutionSection" style="display: none;">
            <h4>La Soluci√≥n - Entendiendo el Bug de Precedencia</h4>
            <p><strong>üêõ El Problema Fundamental:</strong> JavaScript NO eval√∫a la expresi√≥n como el equipo de estudiantes pensaba debido a las reglas de precedencia de operadores.</p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div>
                    <h5 style="color: #e53e3e;">‚ùå Lo que el equipo pens√≥:</h5>
                    <div class="code-display" style="border-left-color: #e53e3e;">
(nota1 * peso1 + nota2 * peso2 + nota3 * peso3) 
/ 
(peso1 + peso2 + peso3)
                    </div>
                </div>
                <div>
                    <h5 style="color: #38a169;">‚úÖ Lo que JavaScript realmente hizo:</h5>
                    <div class="code-display" style="border-left-color: #38a169;">
nota1 * peso1 + nota2 * peso2 
+ (nota3 * peso3 / peso1) 
+ peso2 + peso3
                    </div>
                </div>
            </div>
            
            <div style="background: rgba(159, 122, 234, 0.1); padding: 20px; border-radius: 8px; margin: 20px 0;">
                <h5 style="color: #805ad5;">üõ†Ô∏è La Correcci√≥n Professional:</h5>
                <div class="code-display" style="border-left-color: #805ad5;">
// Soluci√≥n correcta con par√©ntesis expl√≠citos
const numerator = nota1 * peso1 + nota2 * peso2 + nota3 * peso3;
const denominator = peso1 + peso2 + peso3;
const promedio = numerator / denominator;

// O en una l√≠nea con par√©ntesis:
promedio = (nota1 * peso1 + nota2 * peso2 + nota3 * peso3) / (peso1 + peso2 + peso3);
                </div>
            </div>
            
            <div style="background: rgba(229, 62, 62, 0.1); padding: 20px; border-radius: 8px;">
                <h5 style="color: #c53030;">üìö Lecciones Aprendidas:</h5>
                <ul style="color: #4a5568; margin: 10px 0;">
                    <li><strong>Testing Sistem√°tico:</strong> Probar con m√∫ltiples casos, incluyendo edge cases</li>
                    <li><strong>Par√©ntesis Expl√≠citos:</strong> Clarificar intenci√≥n incluso cuando no son t√©cnicamente necesarios</li>
                    <li><strong>Code Review:</strong> Otra persona revisando el c√≥digo habr√≠a detectado el error</li>
                    <li><strong>Validaci√≥n Cruzada:</strong> Comparar resultados con c√°lculos manuales</li>
                </ul>
            </div>
        </div>

        <div class="problem-highlight">
            <h4>ü§î Preguntas de Reflexi√≥n Professional</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 15px;">
                <div style="background: rgba(255, 255, 255, 0.8); padding: 15px; border-radius: 8px;">
                    <strong>üß™ Testing Strategy:</strong><br>
                    <span style="color: #4a5568; font-size: 14px;">¬øPor qu√© algunos casos "funcionan" y otros no? ¬øQu√© casos de prueba habr√≠an expuesto el bug inmediatamente?</span>
                </div>
                <div style="background: rgba(255, 255, 255, 0.8); padding: 15px; border-radius: 8px;">
                    <strong>‚öñÔ∏è Precedencia Impact:</strong><br>
                    <span style="color: #4a5568; font-size: 14px;">¬øC√≥mo afecta exactamente la precedencia de operadores al resultado? ¬øEn qu√© situaciones es m√°s peligrosa?</span>
                </div>
                <div style="background: rgba(255, 255, 255, 0.8); padding: 15px; border-radius: 8px;">
                    <strong>üîç Detection Failure:</strong><br>
                    <span style="color: #4a5568; font-size: 14px;">¬øPor qu√© el equipo no not√≥ el error inmediatamente? ¬øQu√© sesgos cognitivos estaban en juego?</span>
                </div>
                <div style="background: rgba(255, 255, 255, 0.8); padding: 15px; border-radius: 8px;">
                    <strong>üõ°Ô∏è Prevention Systems:</strong><br>
                    <span style="color: #4a5568; font-size: 14px;">¬øQu√© sistemas de validaci√≥n y testing habr√≠an prevenido que 847 estudiantes fueran afectados?</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* =================================================
         * EVALUACION RECURSIVA - INTERMEDIATE ACHIEVEMENT SYSTEM
         * Following Ian Sommerville's systematic debugging approach
         * and Kent C. Dodds' testing-focused development methodology
         * ================================================= */

        // Intermediate-Level Achievement Tracking System
        class DebuggingCaseTracker {
            constructor() {
                this.startTime = Date.now();
                this.metrics = {
                    casesCalculated: 0,
                    correctCalculations: 0,
                    debugSessionsStarted: 0,
                    treeNodesExplored: new Set(),
                    manualCalculationViewed: false,
                    solutionViewed: false,
                    interactiveDebuggingCompleted: false,
                    mistakeCount: 0,
                    engagementScore: 0
                };
                
                this.intermediateLevelRequirements = {
                    minCases: 2,
                    minCorrectCalculations: 2,
                    mustUseDebugger: true,
                    minNodesExplored: 3,
                    mustViewSolution: true
                };
                
                this.initializeDebugUI();
                this.logCaseStart();
            }
            
            // Kent C. Dodds' testing-focused UI initialization
            initializeDebugUI() {
                const indicator = document.getElementById('achievementIndicator');
                const progressSystem = document.getElementById('debugProgressSystem');
                
                setTimeout(() => {
                    indicator.classList.add('active');
                    progressSystem.classList.add('active');
                    this.updateProgress('exploration', 8, 'Debug Laboratory iniciado');
                }, 600);
            }
            
            // Ian Sommerville's systematic progress tracking  
            updateProgress(category, percentage, message) {
                const progressElements = {
                    exploration: 'explorationProgress',
                    debugging: 'debuggingProgress',
                    comprehension: 'comprehensionProgress'
                };
                
                const progressBar = document.getElementById(progressElements[category]);
                if (progressBar) {
                    progressBar.style.width = percentage + '%';
                }
                
                // Check for debugging mastery
                if (this.checkDebuggingMastery()) {
                    this.showMasteryIndicator();
                }
            }
            
            // Robert C. Martin's professional excellence standards for debugging
            checkDebuggingMastery() {
                const reqs = this.intermediateLevelRequirements;
                return (
                    this.metrics.casesCalculated >= reqs.minCases &&
                    this.metrics.correctCalculations >= reqs.minCorrectCalculations &&
                    this.metrics.debugSessionsStarted >= 1 &&
                    this.metrics.treeNodesExplored.size >= reqs.minNodesExplored &&
                    this.metrics.solutionViewed
                );
            }
            
            showMasteryIndicator() {
                if (!this.metrics.interactiveDebuggingCompleted) {
                    this.metrics.interactiveDebuggingCompleted = true;
                    const indicator = document.getElementById('debuggingMastery');
                    const achievementBadge = document.getElementById('achievementIndicator');
                    
                    if (indicator && achievementBadge) {
                        indicator.classList.add('active');
                        achievementBadge.textContent = 'üèÜ ¬°Debug Mastery Achieved!';
                        achievementBadge.style.background = 'linear-gradient(135deg, #38a169, #2f855a)';
                    }
                    
                    this.triggerAchievement('debugging_mastery_achieved', {
                        costPrevented: 847000, // 847 students affected = $1000 each in academic impact
                        difficultyLevel: 'intermediate',
                        actionType: 'debugging_mastery',
                        masteryMetrics: { ...this.metrics }
                    });
                }
            }
            
            // Jonas Schmedtmann's comprehensive engagement scoring
            calculateEngagementScore() {
                let score = 0;
                
                // Basic exploration (30 points)
                if (this.metrics.casesCalculated > 0) score += 10;
                if (this.metrics.casesCalculated >= 2) score += 10;
                if (this.metrics.correctCalculations > 0) score += 10;
                
                // Interactive debugging (40 points)
                if (this.metrics.debugSessionsStarted > 0) score += 15;
                score += Math.min(this.metrics.treeNodesExplored.size * 5, 15);
                if (this.metrics.manualCalculationViewed) score += 10;
                
                // Advanced understanding (30 points)
                if (this.metrics.solutionViewed) score += 15;
                if (this.metrics.interactiveDebuggingCompleted) score += 15;
                
                return Math.min(score, 100);
            }
            
            // Brad Traversy's project-based achievement system
            triggerAchievement(eventType, additionalData = {}) {
                const completionTime = Date.now() - this.startTime;
                this.metrics.engagementScore = this.calculateEngagementScore();
                
                const achievementData = {
                    userId: this.getUserId(),
                    completionTime: completionTime,
                    caseType: 'evaluacion_recursiva',
                    difficultyLevel: 'intermediate',
                    engagementScore: this.metrics.engagementScore,
                    debugMetrics: { ...this.metrics },
                    ...additionalData
                };
                
                // Intermediate-level achievement integration
                if (window.coreAPI && typeof window.coreAPI.triggerCaseCompletion === 'function') {
                    try {
                        window.coreAPI.triggerCaseCompletion(eventType, achievementData);
                        console.log('üèÜ Debug achievement triggered:', eventType, achievementData);
                    } catch (error) {
                        console.warn('Achievement system error:', error);
                        this.fallbackStorage(eventType, achievementData);
                    }
                } else {
                    console.log('üéØ Debug achievement ready:', eventType);
                    this.fallbackStorage(eventType, achievementData);
                }
            }
            
            // Wes Bos's local storage fallback approach
            fallbackStorage(eventType, data) {
                const completions = JSON.parse(localStorage.getItem('debugging-case-progress') || '{}');
                completions[eventType] = { ...data, timestamp: Date.now() };
                localStorage.setItem('debugging-case-progress', JSON.stringify(completions));
            }
            
            getUserId() {
                let userId = localStorage.getItem('bugs-millones-user-id');
                if (!userId) {
                    userId = 'user-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('bugs-millones-user-id', userId);
                }
                return userId;
            }
            
            // Maximilian Schwarzm√ºller's comprehensive case initialization
            logCaseStart() {
                this.triggerAchievement('debugging_case_started', {
                    costPrevented: 0,
                    actionType: 'debug_laboratory_initialized',
                    educationalLevel: 'intermediate'
                });
                console.log('üéì Debugging case initialized - Interactive debugging journey started');
            }
        }

        // Initialize debugging tracking
        const tracker = new DebuggingCaseTracker();

        // Core variables for debugging system  
        let currentExpression = '';
        let evaluationTree = null;
        let currentStep = 0;
        let debugMode = false;

        /* =================================================
         * CORE EDUCATIONAL FUNCTIONALITY - INTERMEDIATE LEVEL
         * Your excellent pedagogy enhanced with achievement integration
         * ================================================= */

        function calculateCase(caseNum) {
            // Intermediate tracking with detailed case analysis
            tracker.metrics.casesCalculated++;
            tracker.updateProgress('exploration', Math.min(tracker.metrics.casesCalculated * 25, 75), 
                                 `${tracker.metrics.casesCalculated} casos analizados`);
            
            const grade1 = parseFloat(document.getElementById(`grade1_${caseNum}`).value);
            const weight1 = parseFloat(document.getElementById(`weight1_${caseNum}`).value);
            const grade2 = parseFloat(document.getElementById(`grade2_${caseNum}`).value);
            const weight2 = parseFloat(document.getElementById(`weight2_${caseNum}`).value);
            const grade3 = parseFloat(document.getElementById(`grade3_${caseNum}`).value);
            const weight3 = parseFloat(document.getElementById(`weight3_${caseNum}`).value);

            // Buggy calculation (student's formula) - This is the actual bug!
            const buggyResult = grade1 * weight1 + grade2 * weight2 + grade3 * weight3 / weight1 + weight2 + weight3;
            
            // Show the actual expression being evaluated
            currentExpression = `${grade1} * ${weight1} + ${grade2} * ${weight2} + ${grade3} * ${weight3} / ${weight1} + ${weight2} + ${weight3}`;
            
            document.getElementById(`result${caseNum}`).innerHTML = `
                <div style="background: linear-gradient(135deg, #fed7d7, #fbb6ce); padding: 15px; border-radius: 8px; margin-top: 15px; border: 2px solid #fc8181;">
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px; align-items: center;">
                        <div>
                            <strong style="font-size: 18px; color: #c53030;">Resultado con F√≥rmula de Estudiantes: ${buggyResult.toFixed(2)}</strong><br>
                            <small style="color: #4a5568;">Expresi√≥n evaluada: ${currentExpression}</small>
                        </div>
                        <div style="text-align: center; padding: 10px; background: rgba(229, 62, 62, 0.2); border-radius: 6px;">
                            <div style="font-size: 14px; color: #c53030;">Caso ${caseNum}</div>
                            <div style="font-size: 20px; color: #e53e3e;">‚ö†Ô∏è</div>
                        </div>
                    </div>
                    <div style="background: rgba(229, 62, 62, 0.1); padding: 10px; border-radius: 6px; margin-top: 10px;">
                        <strong>üö® Nota:</strong> Este resultado parece razonable, pero hay algo sutil que est√° mal. ¬øPuedes detectar el problema?
                    </div>
                </div>
            `;

            // Update test case styling
            document.getElementById(`testCase${caseNum}`).className = 'test-case failed';
            
            // Achievement: Case exploration
            if (tracker.metrics.casesCalculated >= 2) {
                tracker.triggerAchievement('debugging_case_exploration', {
                    costPrevented: 200000,
                    actionType: 'multiple_case_analysis',
                    casesAnalyzed: tracker.metrics.casesCalculated
                });
            }
        }

        function calculateCorrect(caseNum) {
            // Track correct calculations for learning validation
            tracker.metrics.correctCalculations++;
            
            const grade1 = parseFloat(document.getElementById(`grade1_${caseNum}`).value);
            const weight1 = parseFloat(document.getElementById(`weight1_${caseNum}`).value);
            const grade2 = parseFloat(document.getElementById(`grade2_${caseNum}`).value);
            const weight2 = parseFloat(document.getElementById(`weight2_${caseNum}`).value);
            const grade3 = parseFloat(document.getElementById(`grade3_${caseNum}`).value);
            const weight3 = parseFloat(document.getElementById(`weight3_${caseNum}`).value);

            // Correct calculation - This is how it should be done
            const numerator = grade1 * weight1 + grade2 * weight2 + grade3 * weight3;
            const denominator = weight1 + weight2 + weight3;
            const correctResult = numerator / denominator;
            
            const currentResult = document.getElementById(`result${caseNum}`);
            currentResult.innerHTML += `
                <div style="background: linear-gradient(135deg, #c6f6d5, #9ae6b4); padding: 15px; border-radius: 8px; margin-top: 10px; border: 2px solid #68d391;">
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px; align-items: center;">
                        <div>
                            <strong style="font-size: 18px; color: #2f855a;">Resultado Correcto: ${correctResult.toFixed(2)}</strong><br>
                            <small style="color: #4a5568;">F√≥rmula correcta: (${numerator.toFixed(1)}) √∑ (${denominator}) = ${correctResult.toFixed(2)}</small>
                        </div>
                        <div style="text-align: center; padding: 10px; background: rgba(56, 161, 105, 0.2); border-radius: 6px;">
                            <div style="font-size: 14px; color: #2f855a;">Correcto</div>
                            <div style="font-size: 20px; color: #38a169;">‚úÖ</div>
                        </div>
                    </div>
                    <div style="background: rgba(56, 161, 105, 0.1); padding: 10px; border-radius: 6px; margin-top: 10px;">
                        <strong>üìä An√°lisis:</strong> ¬øVes la diferencia? Compare los dos resultados para entender la magnitud del error.
                    </div>
                </div>
            `;
            
            // Update progress based on correct calculations
            tracker.updateProgress('exploration', 
                                 Math.min(50 + (tracker.metrics.correctCalculations * 15), 85),
                                 'Comparaci√≥n correcta vs incorrecta realizada');
                                 
            // Achievement: Understanding validation
            if (tracker.metrics.correctCalculations >= 2) {
                tracker.triggerAchievement('debugging_validation_understanding', {
                    costPrevented: 400000,
                    actionType: 'correct_calculation_validation',
                    validationCount: tracker.metrics.correctCalculations
                });
            }
        }

        function startDebugging() {
            // Track debug session initiation
            tracker.metrics.debugSessionsStarted++;
            tracker.updateProgress('debugging', 25, 'Sesi√≥n de debugging interactivo iniciada');
            
            if (!currentExpression) {
                alert('üß™ Primero calcula uno de los casos para tener una expresi√≥n que debuggear');
                return;
            }

            debugMode = true;
            currentStep = 0;
            
            // Build evaluation tree for interactive debugging
            evaluationTree = buildEvaluationTree(currentExpression);
            
            document.getElementById('debugOutput').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h5 style="color: #f7fafc; margin-bottom: 10px;">üîç Debug Interactivo - Analizando la Expresi√≥n Problem√°tica</h5>
                    <div style="background: rgba(45, 55, 72, 0.8); padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <div style="font-family: monospace; font-size: 14px; color: #fed7d7;">${currentExpression}</div>
                    </div>
                    <div style="color: #a0aec0; font-size: 13px;">
                        üí° <strong>Tip:</strong> Haz clic en los nodos del √°rbol de evaluaci√≥n para entender exactamente c√≥mo JavaScript procesa cada parte.
                    </div>
                </div>
                <div id="interactiveTree"></div>
                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="stepEvaluation()" style="background: #f6ad55; margin: 5px;">‚ñ∂Ô∏è Siguiente Paso</button>
                    <button onclick="resetDebug()" style="background: #e53e3e; margin: 5px;">üîÑ Reset Debug</button>
                    <button onclick="showSolution()" style="background: #38a169; margin: 5px;">üí° Revelar Soluci√≥n</button>
                </div>
                <div id="stepExplanation"></div>
            `;

            renderInteractiveTree();
            showStepExplanation(0);
            
            // Achievement: Debug session started
            tracker.triggerAchievement('debugging_interactive_started', {
                costPrevented: 300000,
                actionType: 'interactive_debugging_initiated',
                debugSession: tracker.metrics.debugSessionsStarted
            });
        }

        function buildEvaluationTree(expr) {
            // Enhanced tree building for educational debugging
            return {
                expression: expr,
                steps: [
                    "üîç JavaScript lee la expresi√≥n de izquierda a derecha, pero respeta precedencia",
                    "üìä Identifica operadores: * y / tienen MAYOR precedencia que + y -",
                    "üå≥ Construye √°rbol de evaluaci√≥n - ¬°Aqu√≠ est√° el problema!",
                    "‚ö†Ô∏è CR√çTICO: La divisi√≥n (/) se eval√∫a ANTES que las sumas (+)",
                    "üßÆ Eval√∫a multiplicaciones y divisiones primero (de izquierda a derecha)", 
                    "‚ûï Luego eval√∫a sumas y restas (de izquierda a derecha)",
                    "üí• Resultado final - ¬°INCORRECTO debido a precedencia mal entendida!"
                ],
                tree: this.parseToTree(expr)
            };
        }

        function parseToTree(expr) {
            return {
                type: 'expression',
                value: expr.replace(/\s+/g, ''),
                problem: 'La divisi√≥n tiene mayor precedencia que la suma, causando evaluaci√≥n incorrecta'
            };
        }

        function renderInteractiveTree() {
            const treeHTML = `
                <div class="evaluation-tree">
                    <h6 style="text-align: center; margin-bottom: 20px; color: #2d3748;">üå≥ √Årbol de Evaluaci√≥n Interactivo</h6>
                    <div style="text-align: center; line-height: 2.5; font-size: 14px;">
                        <div class="tree-node tree-result" onclick="explainNode('result')" id="nodeResult">
                            RESULTADO FINAL
                            <div class="tooltip">Resultado final - INCORRECTO debido a precedencia</div>
                        </div>
                        <br>
                        <div style="color: #4a5568; font-size: 12px; margin: 10px;">‚Üë Suma final</div>
                        <div class="tree-node tree-operator" onclick="explainNode('plus1')" id="nodePlus1">
                            +
                            <div class="tooltip">Suma final - se ejecuta AL FINAL</div>
                        </div>
                        <br>
                        <div class="tree-node tree-operator" onclick="explainNode('plus2')" id="nodePlus2">
                            +
                            <div class="tooltip">Segunda suma - combina con peso3</div>
                        </div>
                        <span style="margin: 0 30px;"></span>
                        <div class="tree-node tree-number" onclick="explainNode('weight3')" id="nodeWeight3">
                            peso3
                            <div class="tooltip">peso3 se SUMA directamente (¬°ERROR!)</div>
                        </div>
                        <br>
                        <div class="tree-node tree-operator" onclick="explainNode('plus3')" id="nodePlus3">
                            +
                            <div class="tooltip">Primera suma - combina multiplicaciones</div>
                        </div>
                        <span style="margin: 0 20px;"></span>
                        <div class="tree-node tree-number" onclick="explainNode('weight2')" id="nodeWeight2">
                            peso2
                            <div class="tooltip">peso2 se SUMA directamente (¬°ERROR!)</div>
                        </div>
                        <br>
                        <div class="tree-node tree-operator" onclick="explainNode('mult1')" id="nodeMult1">
                            √ó
                            <div class="tooltip">Primera multiplicaci√≥n: nota1 √ó peso1</div>
                        </div>
                        <span style="margin: 0 10px;"></span>
                        <div class="tree-node tree-operator" onclick="explainNode('mult2')" id="nodeMult2">
                            √ó
                            <div class="tooltip">Segunda multiplicaci√≥n: nota2 √ó peso2</div>
                        </div>
                        <span style="margin: 0 10px;"></span>
                        <div class="tree-node tree-operator" onclick="explainNode('problematicDiv')" id="nodeProblematicDiv" 
                             style="background: linear-gradient(135deg, #e53e3e, #c53030); animation: pulse-red 1.5s infinite;">
                            √∑
                            <div class="tooltip">üö® ¬°AQU√ç EST√Å EL BUG! Esta divisi√≥n se eval√∫a ANTES que las sumas</div>
                        </div>
                        <br>
                        <div style="color: #4a5568; font-size: 12px; margin: 15px;">Operandos (se eval√∫an en este orden):</div>
                        <div class="tree-node tree-number" onclick="explainNode('grade1')" id="nodeGrade1">nota1</div>
                        <div class="tree-node tree-number" onclick="explainNode('peso1')" id="nodePeso1">peso1</div>
                        <div class="tree-node tree-number" onclick="explainNode('grade2')" id="nodeGrade2">nota2</div>
                        <div class="tree-node tree-number" onclick="explainNode('peso2mult')" id="nodePeso2mult">peso2</div>
                        <div class="tree-node tree-number" onclick="explainNode('grade3')" id="nodeGrade3">nota3</div>
                        <div class="tree-node tree-number" onclick="explainNode('peso3mult')" id="nodePeso3mult">peso3</div>
                        <div class="tree-node tree-number" onclick="explainNode('peso1div')" id="nodePeso1div" style="border: 2px solid #e53e3e;">peso1</div>
                    </div>
                </div>
            `;
            
            document.getElementById('interactiveTree').innerHTML = treeHTML;
        }

        function explainNode(nodeId) {
            // Track node exploration for achievement system
            tracker.metrics.treeNodesExplored.add(nodeId);
            tracker.updateProgress('debugging', 
                                 Math.min(25 + (tracker.metrics.treeNodesExplored.size * 10), 85),
                                 `${tracker.metrics.treeNodesExplored.size} nodos explorados`);
            
            const explanations = {
                'result': 'üéØ Este es el resultado final. Debido a la precedencia de operadores MAL APLICADA, NO es el promedio ponderado correcto que los estudiantes esperaban.',
                'plus1': '‚ûï Suma final. Se ejecuta AL FINAL, despu√©s de todas las multiplicaciones y la divisi√≥n problem√°tica.',
                'plus2': '‚ûï Segunda suma. A√±ade peso2 DIRECTAMENTE al resultado (deber√≠a ser parte del denominador).',
                'plus3': '‚ûï Primera suma. Combina las dos primeras multiplicaciones correctamente.',
                'mult1': '‚úÖ Multiplicaci√≥n nota1 √ó peso1. Esta parte est√° CORRECTA - se eval√∫a antes que las sumas.',
                'mult2': '‚úÖ Multiplicaci√≥n nota2 √ó peso2. Esta parte tambi√©n est√° CORRECTA.',
                'problematicDiv': 'üö® ¬°AQU√ç EST√Å EL BUG CR√çTICO! Esta divisi√≥n se eval√∫a ANTES que las sumas debido a la precedencia de operadores. Divide solo (nota3√ópeso3) entre peso1, NO toda la suma entre todos los pesos.',
                'weight3': '‚ùå peso3 se suma DIRECTAMENTE al resultado. Deber√≠a ser parte del denominador en una fracci√≥n.',
                'weight2': '‚ùå peso2 se suma DIRECTAMENTE al resultado. Deber√≠a ser parte del denominador en una fracci√≥n.',
                'grade1': 'üìä Primera nota del estudiante - usada correctamente.',
                'peso1': 'üìä Peso de la primera nota - usado correctamente en la multiplicaci√≥n.',
                'grade2': 'üìä Segunda nota del estudiante - usada correctamente.',
                'peso2mult': 'üìä peso2 en la multiplicaci√≥n (correcto).',
                'grade3': 'üìä Tercera nota del estudiante - usada correctamente en la multiplicaci√≥n.',
                'peso3mult': 'üìä peso3 en la multiplicaci√≥n (correcto).',
                'peso1div': 'üö® peso1 usado como divisor INDIVIDUAL (¬°INCORRECTO!). Deber√≠a dividir entre la SUMA de todos los pesos.'
            };

            // Visual feedback: remove previous highlights
            document.querySelectorAll('.tree-node').forEach(node => {
                node.classList.remove('tree-active');
            });

            // Highlight clicked node
            const nodeElement = document.getElementById(`node${nodeId.charAt(0).toUpperCase() + nodeId.slice(1)}`);
            if (nodeElement) {
                nodeElement.classList.add('tree-active');
            }

            // Show detailed explanation
            document.getElementById('stepExplanation').innerHTML = `
                <div class="step-explanation active">
                    <strong>üí° An√°lisis Detallado del Nodo:</strong><br>
                    ${explanations[nodeId] || 'Selecciona un nodo para ver su explicaci√≥n detallada.'}
                    <div style="margin-top: 10px; padding: 10px; background: rgba(159, 122, 234, 0.1); border-radius: 6px; font-size: 14px;">
                        <strong>üéì Tip de Debugging:</strong> Observa c√≥mo cada nodo contribuye al resultado final. El bug est√° en la estructura del √°rbol, no en los valores individuales.
                    </div>
                </div>
            `;
            
            // Achievement: Deep node exploration
            if (tracker.metrics.treeNodesExplored.size >= 3) {
                tracker.triggerAchievement('debugging_deep_analysis', {
                    costPrevented: 500000,
                    actionType: 'interactive_tree_exploration',
                    nodesExplored: tracker.metrics.treeNodesExplored.size
                });
            }
        }

        function stepEvaluation() {
            if (currentStep >= evaluationTree.steps.length) {
                showSolution();
                return;
            }

            showStepExplanation(currentStep);
            currentStep++;
            
            // Track step-by-step progression
            tracker.updateProgress('debugging', 
                                 Math.min(40 + (currentStep * 8), 90),
                                 `Paso ${currentStep} de debugging completado`);
        }

        function showStepExplanation(step) {
            if (!evaluationTree) return;

            const explanation = evaluationTree.steps[step];
            document.getElementById('stepExplanation').innerHTML = `
                <div class="step-explanation active">
                    <strong>üîç Paso ${step + 1} de ${evaluationTree.steps.length}:</strong><br>
                    ${explanation}
                    ${step >= 3 ? '<div style="margin-top: 10px; color: #e53e3e; font-weight: 600;">‚ö†Ô∏è Punto cr√≠tico: Aqu√≠ es donde el bug se manifiesta</div>' : ''}
                </div>
            `;
        }

        function resetDebug() {
            currentStep = 0;
            debugMode = false;
            document.getElementById('stepExplanation').innerHTML = '';
            renderInteractiveTree();
            
            // Reset visual feedback
            document.querySelectorAll('.tree-node').forEach(node => {
                node.classList.remove('tree-active');
            });
        }

        function showSolution() {
            // Track solution viewing for mastery assessment
            tracker.metrics.solutionViewed = true;
            tracker.updateProgress('comprehension', 100, '¬°Soluci√≥n completa comprendida!');
            
            document.getElementById('solutionSection').style.display = 'block';
            document.getElementById('solutionSection').scrollIntoView({ behavior: 'smooth' });
            
            // Update achievement indicator
            const achievementBadge = document.getElementById('achievementIndicator');
            achievementBadge.textContent = 'üéì ¬°Debugging Completado!';
            achievementBadge.style.background = 'linear-gradient(135deg, #38a169, #2f855a)';
            
            // Main achievement: Complete debugging case
            tracker.triggerAchievement('debugging_case_complete', {
                costPrevented: 847000, // Full impact: 847 students
                actionType: 'complete_debugging_solution',
                difficultyLevel: 'intermediate',
                debuggingMetrics: {
                    sessionTime: Date.now() - tracker.startTime,
                    casesAnalyzed: tracker.metrics.casesCalculated,
                    correctCalculations: tracker.metrics.correctCalculations,
                    nodesExplored: tracker.metrics.treeNodesExplored.size,
                    debugSessionsCompleted: tracker.metrics.debugSessionsStarted
                },
                educationalOutcome: 'precedence_debugging_mastery'
            });
        }

        function showManualCalculation() {
            // Track manual calculation exploration
            tracker.metrics.manualCalculationViewed = true;
            tracker.updateProgress('comprehension', 60, 'An√°lisis manual consultado');
            
            const explanation = `
                <div class="step-explanation">
                    <strong>üßÆ C√°lculo Manual Paso a Paso - An√°lisis Forense del Bug</strong><br><br>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <strong style="color: #38a169;">‚úÖ Lo que los estudiantes QUER√çAN hacer:</strong><br>
                            <div style="background: rgba(56, 161, 105, 0.1); padding: 12px; border-radius: 6px; margin: 8px 0; font-family: monospace;">
                                Promedio = (nota1√ópeso1 + nota2√ópeso2 + nota3√ópeso3) √∑ (peso1 + peso2 + peso3)
                            </div>
                            <em style="color: #4a5568;">Esta es la f√≥rmula matem√°ticamente correcta para promedio ponderado.</em>
                        </div>
                        <div>
                            <strong style="color: #e53e3e;">‚ùå Lo que JavaScript REALMENTE calcul√≥:</strong><br>
                            <div style="background: rgba(229, 62, 62, 0.1); padding: 12px; border-radius: 6px; margin: 8px 0; font-family: monospace;">
                                = nota1√ópeso1 + nota2√ópeso2 + (nota3√ópeso3√∑peso1) + peso2 + peso3
                            </div>
                            <em style="color: #4a5568;">La precedencia de operadores cambi√≥ completamente la estructura.</em>
                        </div>
                    </div>
                    
                    <div style="background: rgba(159, 122, 234, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong style="color: #805ad5;">üîç ¬øPor qu√© ocurri√≥ este error?</strong><br>
                        <ol style="color: #4a5568; margin: 10px 0 10px 20px;">
                            <li><strong>Precedencia de operadores:</strong> La divisi√≥n (/) tiene mayor precedencia que la suma (+)</li>
                            <li><strong>Evaluaci√≥n de izquierda a derecha:</strong> Para operadores de igual precedencia</li>
                            <li><strong>Falta de par√©ntesis:</strong> No especificaron expl√≠citamente el orden deseado</li>
                            <li><strong>Testing insuficiente:</strong> Solo probaron casos donde el error era menos obvio</li>
                        </ol>
                    </div>
                    
                    <div style="background: rgba(229, 62, 62, 0.1); padding: 15px; border-radius: 8px;">
                        <strong style="color: #c53030;">üìä Impacto del Error:</strong><br>
                        ‚Ä¢ <strong>847 estudiantes</strong> recibieron calificaciones incorrectas<br>
                        ‚Ä¢ <strong>15 estudiantes</strong> reprobaron injustamente<br>
                        ‚Ä¢ <strong>3 semanas</strong> de notas incorrectas en el sistema<br>
                        ‚Ä¢ <strong>18 horas</strong> de debugging intensivo para encontrar el error
                    </div>
                </div>
            `;
            
            document.getElementById('evaluationSteps').innerHTML = explanation;
            
            // Achievement: Manual analysis
            tracker.triggerAchievement('debugging_manual_analysis', {
                costPrevented: 600000,
                actionType: 'manual_calculation_analysis',
                analysisDepth: 'comprehensive'
            });
        }

        // Initialize with first case for immediate engagement
        calculateCase(1);
        
        // Add enhanced CSS animations for debugging experience
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse-red {
                0%, 100% { 
                    opacity: 1; 
                    box-shadow: 0 4px 15px rgba(229, 62, 62, 0.4);
                }
                50% { 
                    opacity: 0.7; 
                    box-shadow: 0 8px 30px rgba(229, 62, 62, 0.8);
                }
            }
        `;
        document.head.appendChild(style);
        
        // Debug case readiness notification
        console.log('üéØ Debug Laboratory ready - The 847 student mystery awaits');
        console.log('üîç Interactive debugging: Find the precedence bug that affected hundreds');
        console.log('üèÜ Achievement tracking: Intermediate-level debugging mastery journey');
    </script>
</body>
</html>